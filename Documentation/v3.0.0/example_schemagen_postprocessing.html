<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/example_schemagen_postprocessing.md at 2021-01-30

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>JAXB-2 Maven Plugin &#x2013; Post-processing Examples - XML Schema Generation</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">JAXB-2 Maven Plugin
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2021-01-30</span>
          &#xA0;| <span id="projectVersion">Version: 3.0.0</span>
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="plugin-info.html" title="Goals">Goals</a></li>
     <li class="none"><a href="filters.html" title="Filters">Filters</a></li>
     <li class="none"><a href="faq.html" title="FAQ">FAQ</a></li>
    </ul>
       <h5>Examples</h5>
    <ul>
     <li class="none"><a href="example_xjc_basic.html" title="XJC: Usage">XJC: Usage</a></li>
     <li class="none"><a href="example_schemagen_basic.html" title="Schemagen: Usage">Schemagen: Usage</a></li>
     <li class="none"><strong>Schemagen: Post-processing</strong></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>Post-processing Examples - XML Schema Generation</h1>
<blockquote>

<p><b>Note</b>: These examples are valid for the 2.x version of the plugin, and do not work for the jaxb2-maven-plugin version 1.x. Post-processing was introduced in version 2 of the jaxb2-maven-plugin.</p>
</blockquote>
<p>The SchemaGenerator (&#x201c;schemagen&#x201d;) tool which is used by the Jaxb2-Maven-plugin to create XML Schema files from JAXB-annotated java source code does not necessarily produce professional-grade XSD files by default. Some properties of the generated XSD files can be augmented for improved usability; this is done by the jaxb2-maven-plugin following the standard SchemaGenerator in the following order:</p>
<p><img src="images/plantuml/postProcessing.png" alt="" /></p>
<p>Each post-processor used by the jaxb2-maven-plugin process XML nodes and hence implement the NodeProcessor interface. A brief explanation of what they do is given in the table below.</p>

<table border="0" class="bodyTable">
    
<tr class="a">
        
<th>NodeProcessor</th>
        
<th>Description</th>
        
<th>Why do we need it?</th>
    </tr>
    
<tr class="b">
        
<td>XsdAnnotationProcessor</td>
        
<td>Copies JavaDoc from Java classes, fields or methods into the generated XSD as
        <a class="externalLink" href="http://www.w3.org/TR/xmlschema-0/#CommVers">XML annotations</a>.</td>
        
<td>Professional XSDs should not be denied containing the JavaDoc supplied in the source code, in particular
        as those JavaDocs frequently explain important facts about permitted values or data use. This postprocessor
        generates <a class="externalLink" href="http://www.w3.org/TR/xmlschema-0/#CommVers">XML documentation annotations</a> from the
        JavaDoc in source code.</td>
    </tr>
    
<tr class="a">
        
<td>ChangeFilenameProcessor</td>
        
<td>Alters the filename of a generated XSD, which by default is schema1.xsd, schema2.xsd etc.</td>
        
<td>Professional XSDs should be defined within usable/understandable file names.
        SchemaGen creates one file per XML namespace in the compilation unit, but the tool cannot figure out how to
        name the XSD files sensibly. With several namespaces in use, it quickly becomes problematic to keep
        track of which XSD file contains which namespace.</td>
    </tr>
    
<tr class="b">
        
<td>ChangeNamespacePrefixProcessor</td>
        
<td>Alters the namespace prefix for namespaces within generated XSDs, which by default is ns1, ns2 etc.</td>
        
<td>Professional XSDs should contain usable/understandable namespace prefixes. For example, this post-processor
        permits changing &lt;xs1:fiscalLaw&gt; to &lt;swedishLaws:fiscalLaw&gt;, to distinguish it
        from &lt;britishLaws:fiscalLaw&gt;.</td>
    </tr>
</table>
<section>
<h2><a name="Example_1:_Adding_XML_documentation_annotations_into_generated_XSDs"></a>Example 1: Adding XML documentation annotations into generated XSDs</h2>
<p>The XsdAnnotationProcessor is used to copy JavaDoc comments from Java source files into generated XSDs. This preserves parts of the information provided in Java source code in the generated XSD files. A typical standard/vanilla XSD file generated by schemagen looks like the following:</p>

<div>
<div>
<pre class="source">    &lt;xs:complexType name=&quot;somewhatNamedPerson&quot;&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name=&quot;firstName&quot; type=&quot;xs:string&quot; nillable=&quot;true&quot; minOccurs=&quot;0&quot;/&gt;
            &lt;xs:element name=&quot;lastName&quot; type=&quot;xs:string&quot;/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name=&quot;age&quot; type=&quot;xs:int&quot; use=&quot;required&quot;/&gt;
    &lt;/xs:complexType&gt;
</pre></div></div>

<p>While the significance of the elements and attribute in the complex type above might appear self-evident, the XSD is somewhat barren since no JavaDoc information is injected into it. XML has a standard for documenting elements, described in the <a class="externalLink" href="http://www.w3.org/TR/xmlschema11-1/#cAnnotations">XML Schema Definitions standard</a>. This standard is used by the XsdAnnotationProcessor to insert JavaDoc from fields into the XSD, augmenting the result from above to the following:</p>

<div>
<div>
<pre class="source">     &lt;xs:complexType name=&quot;somewhatNamedPerson&quot;&gt;
        &lt;xs:annotation&gt;
            &lt;xs:documentation&gt;&lt;![CDATA[Definition of a person with lastName and age, and optionally a firstName as well...

            (author): &lt;a href=&quot;mailto:lj@jguru.se&quot;&gt;Lennart J&amp;ouml;relid&lt;/a&gt;, jGuru Europe AB
            (custom): A custom JavaDoc annotation.]]&gt;&lt;/xs:documentation&gt;
        &lt;/xs:annotation&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element minOccurs=&quot;0&quot; name=&quot;firstName&quot; nillable=&quot;true&quot; type=&quot;xs:string&quot;&gt;
                &lt;xs:annotation&gt;
                    &lt;xs:documentation&gt;&lt;![CDATA[The first name of the SomewhatNamedPerson.]]&gt;&lt;/xs:documentation&gt;
                &lt;/xs:annotation&gt;
            &lt;/xs:element&gt;
            &lt;xs:element name=&quot;lastName&quot; type=&quot;xs:string&quot;&gt;
                &lt;xs:annotation&gt;
                    &lt;xs:documentation&gt;&lt;![CDATA[The last name of the SomewhatNamedPerson.]]&gt;&lt;/xs:documentation&gt;
                &lt;/xs:annotation&gt;
            &lt;/xs:element&gt;
       &lt;/xs:sequence&gt;
       &lt;xs:attribute name=&quot;age&quot; type=&quot;xs:int&quot; use=&quot;required&quot;&gt;
           &lt;xs:annotation&gt;
               &lt;xs:documentation&gt;&lt;![CDATA[The age of the SomewhatNamedPerson. Must be positive.]]&gt;&lt;/xs:documentation&gt;
           &lt;/xs:annotation&gt;
       &lt;/xs:attribute&gt;
     &lt;/xs:complexType&gt;
</pre></div></div>

<p>The JavaDoc inserted as XML documentation elements is read directly from the source code (shown below). Note that all copied JavaDoc is wrapped in <a class="externalLink" href="http://www.w3schools.com/xml/xml_cdata.asp">CDATA</a> tags to permit any JavaDoc text without risking to create invalid XML within the XSD file.</p>

<div>
<div>
<pre class="source">/**
 * Definition of a person with lastName and age, and optionally a firstName as well...
 *
 * @author &lt;a href=&quot;mailto:lj@jguru.se&quot;&gt;Lennart J&amp;ouml;relid&lt;/a&gt;, jGuru Europe AB
 * @custom A custom JavaDoc annotation.
 */
@XmlRootElement
@XmlType(namespace = SomewhatNamedPerson.NAMESPACE, propOrder = {&quot;firstName&quot;, &quot;lastName&quot;, &quot;age&quot;})
@XmlAccessorType(XmlAccessType.FIELD)
public class SomewhatNamedPerson {

    /**
     * The XML namespace of this SomewhatNamedPerson.
     */
    public static final String NAMESPACE = &quot;http://some/namespace&quot;;

    /**
     * The first name of the SomewhatNamedPerson.
     */
    @XmlElement(nillable = true, required = false)
    private String firstName;

    /**
     * The last name of the SomewhatNamedPerson.
     */
    @XmlElement(nillable = false, required = true)
    private String lastName;

    /**
     * The age of the SomewhatNamedPerson. Must be positive.
     */
    @XmlAttribute(required = true)
    private int age;

    ... The rest of the class omitted in this listing  ...
}
</pre></div></div>

<p>The schemagen goal configuration within the POM automatically copies JavaDoc data as annotations into the XSD files - simply activate the goal within the plugin&#x2019;s configuration.</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;jaxb2-maven-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;schemagen&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;schemagen&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
</pre></div></div>
<section>
<h3><a name="Formatting_XSD_documentation_annotations"></a>Formatting XSD documentation annotations</h3>
<p>The jaxb2-maven-plugin holds a JavaDocRenderer instance used to convert a JavaDoc comment into plain text, to be inserted into the annotation element. Unless overridden in the plugin&#x2019;s configuration, a default JavaDocRenderer is used. You can change the formatting to a format better suited to your needs by implementing a custom JavaDocRenderer and telling the plugin to use it:</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;jaxb2-maven-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;schemagen&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;schemagen&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;javaDocRenderer&gt;org.acme.render.MyJavaDocRenderer&lt;/javaDocRenderer&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
</pre></div></div>

<p>The class provided should implement the interface JavaDocRenderer; the default implementation is shown below. The result of the render method is inserted into the generated XSD. Neither of the two parameters will be null for any call to the render method. The JavaDocData structure contains the JavaDoc comment (which is all text in the JavaDoc not part of a JavaDoc tag) and a Map relating tag names to their respective values.</p>

<div>
<div>
<pre class="source">public class DefaultJavaDocRenderer implements JavaDocRenderer {

    /**
     * &lt;p&gt;Renders the supplied JavaDocData structure as text to be used within an XSD documentation annotation.
     * The XSD documentation annotation will contain a CDATA section to which the rendered JavaDocData is
     * emitted.&lt;/p&gt;
     *
     * @param nonNullData the JavaDocData instance to render as XSD documentation. Will never be {@code null}.
     * @param location    the SortableLocation where the JavaDocData was harvested. Never {@code null}.
     * @return The rendered text contained within the XML annotation.
     */
    @Override
    public String render(final JavaDocData nonNullData, final SortableLocation location) {

        // Compile the XSD documentation string for this Node.
        final StringBuilder builder = new StringBuilder();
        builder.append(nonNullData.getComment()).append(&quot;\n\n&quot;);
        for (Map.Entry&lt;String, String&gt; current : nonNullData.getTag2ValueMap().entrySet()) {

            final String tagDocumentation = &quot;(&quot; + current.getKey() + &quot;): &quot; + current.getValue() + &quot;\n&quot;;
            builder.append(tagDocumentation);
        }

        // All done.
        return builder.toString();
    }
}
</pre></div></div>
</section></section><section>
<h2><a name="Example_2:_Transforming_schema"></a>Example 2: Transforming schema</h2>
<p>XSD files, like java classes, are combined data- and structure definitions. As such they should communicate structure clearly to anyone consuming/using the definitions, and also adhere to usability engineering principles. Sadly, the schemagen tool distributed with the JDK does not generate XSD files which comply with some minimalistic usability principles:</p>
<ol style="list-style-type: decimal">

<li>schemagen&#x2019;s generated XSD files have names on the form schema#.xsd (where &#x201c;#&#x201d; is a number), which makes it unnecessarily difficult to understand which XML ComplexType is defined where, or what domain the ComplexTypes in the file belongs to.</li>
<li>schemagen&#x2019;s generated XSD files have XML namespaces prefixes on the form ns# (where &#x201c;#&#x201d; is a number). This makes it unnecessarily complex to understand which complex type is actually referred to. (Does ns2:fiscalLaw refer to the ComplexType in the swedish or the british namespace? It would be much simpler to use appropriate XML namespace prefixes in the generated files, such as swedishLaws:fiscalLaw or britishLaws:fiscalLaw).</li>
</ol>
<p>The TransformSchema element permits developers to both change the names of generated XSD files and the XML namespace prefixes within the generated files. A TransformSchemas configuration element is a list of transformSchema objects, each of which has a namespace URI (mandatory) and two optional properties (toPrefix and toFile). As shown in the snippet below, 3 namespaces are transformed to be given user-friendly prefixes and file names:</p>

<div>
<div>
<pre class="source">    &lt;!--
        Post-processing 2: Transform the generated XML Schemas.
    --&gt;
    &lt;transformSchemas&gt;
        &lt;transformSchema&gt;
            &lt;uri&gt;http://some/namespace&lt;/uri&gt;
            &lt;toPrefix&gt;some&lt;/toPrefix&gt;
            &lt;toFile&gt;some_schema.xsd&lt;/toFile&gt;
        &lt;/transformSchema&gt;
        &lt;transformSchema&gt;
            &lt;uri&gt;http://another/namespace&lt;/uri&gt;
            &lt;toPrefix&gt;another&lt;/toPrefix&gt;
            &lt;toFile&gt;another_schema.xsd&lt;/toFile&gt;
        &lt;/transformSchema&gt;
        &lt;transformSchema&gt;
            &lt;uri&gt;http://yet/another/namespace&lt;/uri&gt;
            &lt;toPrefix&gt;yetAnother&lt;/toPrefix&gt;
            &lt;toFile&gt;yet_another_schema.xsd&lt;/toFile&gt;
        &lt;/transformSchema&gt;
    &lt;/transformSchemas&gt;
</pre></div></div>

<p>The full plugin configuration containing 2 post-processors is shown below:</p>

<div>
<div>
<pre class="source">                    &lt;plugin&gt;
                       &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                       &lt;artifactId&gt;jaxb2-maven-plugin&lt;/artifactId&gt;
                       &lt;executions&gt;
                           &lt;execution&gt;
                               &lt;id&gt;schemagen&lt;/id&gt;
                               &lt;goals&gt;
                                   &lt;goal&gt;schemagen&lt;/goal&gt;
                               &lt;/goals&gt;
                           &lt;/execution&gt;
                       &lt;/executions&gt;
                       &lt;configuration&gt;
                           &lt;!--
                             Post-processing 1: Don't create JavaDoc annotations.
                           --&gt;
                           &lt;createJavaDocAnnotations&gt;false&lt;/createJavaDocAnnotations&gt;
                           &lt;!--
                             Post-processing 2: Transform the generated XML Schemas.
                           --&gt;
                           &lt;transformSchemas&gt;
                               &lt;transformSchema&gt;
                                   &lt;uri&gt;http://some/namespace&lt;/uri&gt;
                                   &lt;toPrefix&gt;some&lt;/toPrefix&gt;
                                   &lt;toFile&gt;some_schema.xsd&lt;/toFile&gt;
                               &lt;/transformSchema&gt;
                               &lt;transformSchema&gt;
                                   &lt;uri&gt;http://another/namespace&lt;/uri&gt;
                                   &lt;toPrefix&gt;another&lt;/toPrefix&gt;
                                   &lt;toFile&gt;another_schema.xsd&lt;/toFile&gt;
                               &lt;/transformSchema&gt;
                               &lt;transformSchema&gt;
                                   &lt;uri&gt;http://yet/another/namespace&lt;/uri&gt;
                                   &lt;toPrefix&gt;yetAnother&lt;/toPrefix&gt;
                                   &lt;toFile&gt;yet_another_schema.xsd&lt;/toFile&gt;
                               &lt;/transformSchema&gt;
                           &lt;/transformSchemas&gt;
                       &lt;/configuration&gt;
                   &lt;/plugin&gt;
</pre></div></div>

<p>Note that a TransformSchema element can omit either toPrefix or toFile to yield a configuration similar to the following:</p>

<div>
<div>
<pre class="source">                &lt;!--
                  Post-processing 2: Transform the generated XML Schemas.
                --&gt;
                &lt;transformSchemas&gt;
                    &lt;transformSchema&gt;
                        &lt;uri&gt;http://some/namespace&lt;/uri&gt;
                        &lt;toPrefix&gt;some&lt;/toPrefix&gt;
                        &lt;toFile&gt;some_schema.xsd&lt;/toFile&gt;
                    &lt;/transformSchema&gt;
                    &lt;transformSchema&gt;
                        &lt;uri&gt;http://another/namespace&lt;/uri&gt;
                        &lt;toPrefix&gt;another&lt;/toPrefix&gt;
                    &lt;/transformSchema&gt;
                    &lt;transformSchema&gt;
                        &lt;uri&gt;http://yet/another/namespace&lt;/uri&gt;
                        &lt;toFile&gt;yet_another_schema.xsd&lt;/toFile&gt;
                    &lt;/transformSchema&gt;
                &lt;/transformSchemas&gt;
</pre></div></div></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2005&#x2013;2021<a href="https://www.mojohaus.org">MojoHaus</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
