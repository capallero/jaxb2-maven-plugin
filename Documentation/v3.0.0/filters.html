<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/filters.md at 2021-01-30

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>JAXB-2 Maven Plugin &#x2013; Filters and Filtering</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">JAXB-2 Maven Plugin
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2021-01-30</span>
          &#xA0;| <span id="projectVersion">Version: 3.0.0</span>
      </div>
      <div class="xright">      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="index.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="plugin-info.html" title="Goals">Goals</a></li>
     <li class="none"><strong>Filters</strong></li>
     <li class="none"><a href="faq.html" title="FAQ">FAQ</a></li>
    </ul>
       <h5>Examples</h5>
    <ul>
     <li class="none"><a href="example_xjc_basic.html" title="XJC: Usage">XJC: Usage</a></li>
     <li class="none"><a href="example_schemagen_basic.html" title="Schemagen: Usage">Schemagen: Usage</a></li>
     <li class="none"><a href="example_schemagen_postprocessing.html" title="Schemagen: Post-processing">Schemagen: Post-processing</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>Filters and Filtering</h1>
<blockquote>

<p><b>Note</b>: This documentation pertains to the 2.x version of the plugin.</p>
</blockquote>
<p>Frequently, we would like exclude some files from being used as sources for XJC or SchemaGen. For example, if all Java Sources placed under src/main/java <i>except one</i> should be used to distill the XSD files by SchemaGen we must configure the SchemaGen mojo to exclude that particular file.</p>
<p>This type of operation is done with a Filter, which - in this case - identifies Files to exclude from the normal operation. The Java world sports several projects that define Filters, such as <a class="externalLink" href="https://ant.apache.org/manual/Tasks/filter.html">the filter definitions in Apache ANT</a>, the <a class="externalLink" href="https://code.google.com/p/lambdaj/">LambdaJ</a> from Google or the JDK 8 java.util.stream collection filtering. Most of these implementations, however, work in slightly different ways which tends to complicate the life of us programmers quite a bit. Just remembering the exact syntax to create a Filter from one of these projects can be somewhat problematic. Moreover, the JDK 8 mechanics cannot be used as the jaxb2-maven-plugin must be binary compatible with JDK 1.6+.</p><section>
<h2><a name="Filters_in_the_JAXB2_Maven_Plugin"></a>Filters in the JAXB2 Maven Plugin</h2>
<p>Filters used by the JAXB2 Maven plugin are visitors, similar in structure to the well-known java.io.FileFilter. As shown in the listing below, the Filters used by the Jaxb2 Maven Plugin sport 2 methods:</p>
<ol style="list-style-type: decimal">

<li>initialize: Injects the active Maven Log into the Filter, to enable proper logging from within the Filter.</li>
<li>accept: The actual filter method which returns true if the given candidate is accepted and false otherwise.

<div>
<div>
<pre class="source">public interface Filter&lt;T&gt; {

    /**
    * Initializes this Filter, and assigns the supplied Log for use by this Filter.
    *
    * @param log The non-null Log which should be used by this Filter to emit log messages.
    */
    void initialize(Log log);

     /**
     * @return {@code true} if this Filter has been properly initialized (by a call to 
     *         the {@code initialize} method).
     */
     boolean isInitialized();

    /**
    * &lt;p&gt;Method that is invoked to determine if a candidate instance should be accepted or not.
    * Implementing classes should be prepared to handle {@code null} candidate objects.&lt;/p&gt;
    *
    * @param candidate The candidate that should be tested for acceptance by this Filter.
    * @return {@code true} if the candidate is accepted by this Filter and {@code false} otherwise.
    * @throws java.lang.IllegalStateException if this Filter is not initialized by a call to the
    *                                         initialize method before calling this matchAtLeastOnce method.
    */
    boolean accept(T candidate) throws IllegalStateException;
}
</pre></div></div>
</li>
</ol>
<p>While this Filter implementation is simple enough to be implemented directly, the jaxb2-maven-plugin codebase contains implementations intended to simplify creating custom Filters - and indeed some concrete implementations as well. The inheritance hierarchy contains several types, as shown in the image below:</p>
<p><img src="images/FilterHierarchy.png" style="border: solid DarkGray 1px;" alt="" /></p>
<p>The Filter types are described below:</p>
<ol style="list-style-type: decimal">

<li>AbstractFilter: abstract Filter implementation. Handles separating <i>null</i> candidate values from non-null ones, and delegates processing to concrete subclass implementations.</li>
<li>AbstractPatternFilter: subclass to AbstractFilter, which contains a List of java.util.regex.Pattern objects used to match/accept a candidate or reject it. Since java regexp Patterns work primarily on Strings, each AbstractPatternFilter has a StringConverter which converts candidate objects to strings for matching.</li>
</ol>
<p>The jaxb2-maven-plugin also contains two concrete Filter implementations, directly usable in the plugin&#x2019;s configuration:</p>
<ol style="list-style-type: decimal">

<li>PatternFileFilter: An AbstractPatternFilter implementation which matches java.io.Files. By default, the PatternFileFilter has a StringConverter which submits the full path of each File for matching. You can change the implementation by setting the converter property to a custom converter which uses another algorithm for converting each candidate File to a String for matching.</li>
<li>PatternURLFilter: An AbstractPatternFilter implementation which matches java.io.URLs. Unless overridden, the PatternURLFilter uses a normalized string form of each submitted URL for matching. (Normalizing a URL is done in the following manner: anURL.toURI().normalize().toURL().toString()).</li>
</ol>
<p>A slightly more detailed class diagram than the one above is shown below:</p>
<p><img src="images/plantuml/detailedFilterHierarchy.png" style="border: solid DarkGray 1px;" alt="" /></p></section><section>
<h2><a name="Filter_examples:_PatternFileFilter"></a>Filter examples: PatternFileFilter</h2>
<p>Excluding some files from processing is a straightforward task. Create a PatternFileFilter instance and populate it with some pattern strings from which it should create java.util.regexp.Patterns. A PatternFileFilter which matches any file whose full path end with .xsd or .foo is defined as follows:</p>

<div>
<div>
<pre class="source">        &lt;filter implementation=&quot;org.codehaus.mojo.jaxb2.shared.filters.pattern.PatternFileFilter&quot;&gt;
            &lt;patterns&gt;
                &lt;pattern&gt;\.xsd&lt;/pattern&gt;
                &lt;pattern&gt;\.foo&lt;/pattern&gt;
            &lt;/patterns&gt;
        &lt;/filter&gt;
</pre></div></div>

<p>But &#x2026; wait a second. If the patterns supplied in the configuration snippet above are intended to match the full path of the file /some/path/to/src/main/xsd/blah.xsd, the pattern specification above is clearly not sufficient. The PatternFileFilter must prepend some other string to create a Pattern able to match the given file path. The string prepended to the supplied patterns is given by the configuration property patternPrefix, which defaults to the value (\\p{javaLetterOrDigit}|\\p{Punct})+. Therefore, each pattern string in the configuration above is prepended to yield the two effective patterns:</p>
<ol style="list-style-type: decimal">

<li>(\\p{javaLetterOrDigit}|\\p{Punct})+\.xsd, and</li>
<li>(\\p{javaLetterOrDigit}|\\p{Punct})+\.foo</li>
</ol>
<p>These two patterns are sufficient for matching the fully qualified path of the file /some/path/to/src/main/xsd/blah.xsd. For clarity, the effective pattern string used to compile the Patterns for matching files are also emitted when you run the jaxb2-maven-plugin with debug log settings. An example of typical output plugin debug logging is harvested from one of the integration tests in the jaxb2-maven-plugin itself. Note the two resulting regular expressions used by the PatternFileFilter:</p>

<div>
<div>
<pre class="source">+=================== [Filtered sources]
|
| 1 Exclude patterns:
| [1/1]: Filter [PatternFileFilter]
|        Processes nulls: [false]
|        Accept on match: [true]
|        2 regularExpressions ...
|         [0/2]: (\p{javaLetterOrDigit}|\p{Punct})+\.xsd
|         [1/2]: (\p{javaLetterOrDigit}|\p{Punct})+\.foo
|
| 1 Standard Directories:
| [1/1]: src/main/xsd
|
| 3 Results:
| [1/3]: file:/Users/lj/Development/Projects/Codehaus/github_jaxb2_plugin/target/it/xjc-exclude-file-patterns/src/main/foo/gnat.txt
| [2/3]: file:/Users/lj/Development/Projects/Codehaus/github_jaxb2_plugin/target/it/xjc-exclude-file-patterns/src/main/someOtherXsds/fooSchema.txt
| [3/3]: file:/Users/lj/Development/Projects/Codehaus/github_jaxb2_plugin/target/it/xjc-exclude-file-patterns/src/main/someOtherXsds/some_schema.bar
|
+=================== [End Filtered sources]
</pre></div></div>

<p>A maven configuration for creating a PatternFileFilter which excludes any source files whose full paths end in either .xsd or .foo is done as follows:</p>

<div>
<div>
<pre class="source">    &lt;!--
        When providing xjcSourceExcludeFilters, the default exclude
        Filter definitions are overridden by the Patterns supplied.

        The filter below matches all Files with full paths that end with &quot;.xsd&quot; or &quot;.foo&quot;.
    --&gt;
    &lt;xjcSourceExcludeFilters&gt;
        &lt;filter implementation=&quot;org.codehaus.mojo.jaxb2.shared.filters.pattern.PatternFileFilter&quot;&gt;
            &lt;patterns&gt;
                &lt;pattern&gt;\.xsd&lt;/pattern&gt;
                &lt;pattern&gt;\.foo&lt;/pattern&gt;
            &lt;/patterns&gt;
        &lt;/filter&gt;
    &lt;/xjcSourceExcludeFilters&gt;
</pre></div></div>

<p>Filters can be used to identify files to be excluded from processing by XJC and SchemaGen. All configuration properties for Mojos within the jaxb2-maven-plugin use optional Filters to identify these</p><section>
<h3><a name="Configuring_a_pattern_filter"></a>Configuring a pattern filter</h3>
<p>For a fuller example of configuring a PatternFileFilter, refer to the <a href="./example_schemagen_basic.html">SchemaGen Basic Usage</a> page.</p></section></section><section>
<h2><a name="Creating_custom_Filter_implementations"></a>Creating custom Filter implementations</h2>
<p>Should you want to integrate another Filter implementation for pattern matching into the jaxb2-maven-plugin configuration, you can simply implement and configure new Filter. In this case, we recommend that your implementation extend the AbstractFilter class (or any of its subclasses) to reuse the default lifecycle implemented there.</p>
<p>When implemented, configure the jaxb2-maven-plugin to use your Filter - and do not forget to add the fully qualified class name of your custom Filter class:</p>

<div>
<div>
<pre class="source">    &lt;!--
        Use a custom Filter to find and exclude XJC sources.
    --&gt;
    &lt;xjcSourceExcludeFilters&gt;
        &lt;filter implementation=&quot;my.custom.Filter&quot;&gt;
            ... Configuration properties for your Filter implementation here ...
        &lt;/filter&gt;
    &lt;/xjcSourceExcludeFilters&gt;
</pre></div></div>

<p>Feel free to submit well-documented Filter implementations to the jaxb2-maven-plugin team if you feel they ought to be included within the standard distribution.</p></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2005&#x2013;2021<a href="https://www.mojohaus.org">MojoHaus</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
